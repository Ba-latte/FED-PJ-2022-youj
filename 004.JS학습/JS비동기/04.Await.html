<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>JSë¹„ë™ê¸° : 4. Async / Await ì‚¬ìš©ë²•</title>
        <script>
            /******************************************************************* 
                [Async/Awaitë€? "ì•½ì†ì„ ì¢€ ë” ì‰½ê²Œ!"]

            1. asyncëŠ” í•¨ìˆ˜ê°€ Promiseë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•œë‹¤!
            2. awaitëŠ” í•¨ìˆ˜ê°€ Promiseë¥¼ ê¸°ë‹¤ë¦¬ê²Œ ì„¤ì •í•œë‹¤!

            [ async êµ¬ë¬¸ ì‚¬ìš©ë²• ]
            ___________________________________

            -> í•¨ìˆ˜ì•ì— async í‚¤ì›Œë“œë¥¼ ì¨ì¤€ë‹¤!
            ___________________________________

            async function ë‚´í•¨ìˆ˜() {
                return "ìš°ë¦¬ì§€ê¸ˆë§Œë‚˜!";
            }
            ____________________________________

            -> ìœ„ì˜ ì½”ë“œëŠ” ì•„ë˜ì˜ ì½”ë“œì™€ ë™ì¼í•˜ë‹¤!
            ____________________________________

            function ë‚´í•¨ìˆ˜() {
                return Promise.resolve("ìš°ë¦¬ì§€ê¸ˆë§Œë‚˜!");
            }
            _______________________________________________________

            -> asyncí‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ í•¨ìˆ˜í˜¸ì¶œì½”ë“œ ë’¤ì— .thenì„ ì‚¬ìš©í•˜ì—¬
                ì„±ê³µì‹œ/ì‹¤íŒ¨ì‹œì½”ë“œë¥¼ ì‘ì„±í•œë‹¤!
            _______________________________________________________

            ë‚´í•¨ìˆ˜().then(
                function(value) { ì„±ê³µì‹œì½”ë“œ },
                function(error) { ì‹¤íŒ¨ì‹œì½”ë“œ }
            );
            ____________________________________
            
            [ await êµ¬ë¬¸ ì‚¬ìš©ë²• ]
            ___________________________________

            -> awaití‚¤ì›Œë“œëŠ” 
                asyncí•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥í•¨.
            -> awaití‚¤ì›Œë“œ ëŠ” 
                í•¨ìˆ˜ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  ê³„ì†í•˜ê¸° 
                ì „ì— Promiseì˜ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¼
            ___________________________________

            async function ë³´ì—¬ì¤˜() {
            let ë‚´ì•½ì† = new Promise(function(ì„±ê³µí•¨ìˆ˜) {
                    ì„±ê³µí•¨ìˆ˜("ë‚´ë©”ì„¸ì§€");
                });
                document.getElementById("mydiv").innerHTML = await ë‚´ì•½ì†;
            }

            ë³´ì—¬ì¤˜();
            ___________________________________

            ((ë‹¨ì–´ëœ»))
            * resolve í•´ê²°í•˜ë‹¤
            * asynchronous ë™ì‹œì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”
            * await ê¸°ë‹¤ë¦¬ë‹¤
            *******************************************************************/

            function í™”ë©´ë¿Œë ¤(ì´ê±°){
                document.getElementById("show").innerHTML += ì´ê±° + "<br>";
            }

            // 1.async / await ê¸°ë³¸ êµ¬ë¬¸ ì‚¬ìš©í•˜ê¸°
            async function ë³´ì—¬ì¤˜(){
                let ì•½ì†ê¸°ë‹¤ë¦¼ = new Promise(
                    (success)=>{

                        // 3ì´ˆ ì‹œê°„ ì§€ì—° ì£¼ê¸°
                        setTimeout(() => {
                            // ì„±ê³µí•¨ìˆ˜ í˜¸ì¶œ!
                            success("ë¬¸ë‹¨ì†í•´ì¤˜!");
                            
                        }, 3000);

                }); ////////// ì•½ì† ê¸°ë‹¤ë¦¼ /////////////
                // then() ë©”ì„œë“œë¥¼ ëŒ€ì²´í•˜ì—¬ awaitê°€ ëŒ€ê¸° í›„ì— ì‹¤í–‰ ì—°ê²°í•´ì¤€ë‹¤
                í™”ë©´ë¿Œë ¤(await ì•½ì†ê¸°ë‹¤ë¦¼);
                í™”ë©´ë¿Œë ¤(await `<img src="https://cdn.hankooki.com/news/photo/202304/67837_90529_1680302888.jpg" style="height:70vh" alt="ìŠ¤ì¦ˆë©”ì˜ ë¬¸ë‹¨ì†">`);
                /********************************************************
                    [ then() êµ¬ë¬¸ê³¼ ë¹„êµ ]
                ì•½ì†ê¸°ë‹¤ë¦¼.then((msg)=>{
                    í™”ë©´ë¿Œë ¤(msg);
                });
                ********************************************************/


            } ////////////// async ë³´ì—¬ì¤˜ í•¨ìˆ˜ ////////////////


            // asyncí•¨ìˆ˜ ìµœì´ˆ í˜¸ì¶œ
            ë³´ì—¬ì¤˜();


            // ğŸ¥°2.íŒŒì¼ì„ ì „ì†¡ë°›ì€ í›„ ì‹¤í–‰í•˜ëŠ” ì•½ì†ê°ì²´ ìƒì„±í•˜ê¸°
            async function íŒŒì¼ë°›ì•„(){
                let íŒŒì¼ì•½ì† = new Promise(
                    function(success){
                        // ajax(ë¹„ë™ê¸°í†µì‹ )ë¡œ ì„œë²„ íŒŒì¼ ìš”ì²­í•˜ê¸°
                        // (1)XMLHttpRequset ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ê¸°
                        let ajax = new XMLHttpRequest();
                        
                        // (2)ë¹„ë™ê¸° íŒŒì¼ìš”ì²­ ì—´ê¸° (=ì „ì†¡ ê¸°ëŠ¥ ë©”ëª¨ë¦¬ ìƒì„±í•˜ê¸°)
                        ajax.open("GET", "https://koreascience.kr/article/JAKO201812055796720.pdf");
    
                        // (3)ê²°ê³¼ë¥¼ ë¦¬í„´ë°›ëŠ” onload ì´ë²¤íŠ¸ í•¨ìˆ˜êµ¬ì—­ ë§Œë“¤ê¸°
                        ajax.onload = function(){
                            console.log(ajax.status);
                            if(ajax.status === 200){
                                success(ajax.responseURL);
                                // ì„±ê³µì‹œ ì „ì†¡ë°›ì€ íŒŒì¼ URLì„ ë°›ëŠ”ë‹¤!
                            }
                        }; ////////// onload ///////////
    
                        // ğŸ”¥(4)ë¹„ë™ê¸° ìš”ì²­ë³´ë‚´ê¸° : send()
                        ajax.send();
                    }); //////////// íŒŒì¼ì•½ì† Promise ////////////

                    // await ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ê¸°
                    const ë¬¸ì„œë³´ì—¬ì¤˜ = (txt) => {
                        console.log("ë¬¸ì„œë³´ì—¬ì¤˜ í•¨ìˆ˜ : ", txt);
                        document.getElementById("doc").innerHTML = `<iframe src="${txt}" style="width:100%;height:100%"></iframe>`;
                    }; /////////////// ë¬¸ì„œë³´ì—¬ì¤˜ í•¨ìˆ˜ /////////////////
    

                    // ì‹¤í–‰ í•¨ìˆ˜ í˜¸ì¶œ!
                    ë¬¸ì„œë³´ì—¬ì¤˜(await íŒŒì¼ì•½ì†);
                
            } //////////// async íŒŒì¼ë°›ì•„ í•¨ìˆ˜ //////////////


            // async íŒŒì¼ë°›ì•„ í•¨ìˆ˜ ìµœì´ˆ í˜¸ì¶œ
            íŒŒì¼ë°›ì•„();




            
        </script>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap");
            body {
                background-image: linear-gradient(to bottom, #494949, gray);
                background-repeat: no-repeat;
                background-attachment: fixed;
                text-align: center;
            }
            #show {
                font-family: "Gamja Flower", cursive;
                font-size: 4vw;
                background-image: linear-gradient(to bottom, lightgreen, pink, orangered, aquamarine);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-repeat: no-repeat;
                font-weight: bold;
            }
            #doc{
                width: 50%;
                height: 50vh;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div id="show"></div>
        <div id="doc"></div>
    </body>
</html>
